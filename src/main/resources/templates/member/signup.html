<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{top::menu}"></div>
<title>TEST MEMBER</title>
<body>
<!-- id check -->
<script>
    var isidAvailable = false;

    $(document).ready(function () {
        $("#id_check").click(function () {
            var id = $("#id").val();
            var idRegex = /^[a-zA-Z0-9]{4,12}$/;

            if (!idRegex.test(id)) {
                alert('아이디는 4자 ~ 12자 이하의 영문자 또는 숫자만 가능합니다.');
                $("#id").focus();
                return;
            }

            $.ajax({
                type: "post",
                url: "idcheck",
                data: {"id": id},
                success: function (data) {
                    if (data === "ok") {
                        alert("사용 가능한 아이디입니다.");
                        isidAvailable = true;
                    } else {
                        alert("이미 사용중인 아이디입니다.");
                        isidAvailable = false;
                        $("#id").focus();
                    }
                },
                error: function () {
                    alert("서버 통신 중 오류가 발생했습니다.");
                }
            });
        });
    });
</script>

<!-- pw check -->
<script>
var isPwMatch = false;

$(document).ready(function () {
    $("#pw_check_btn").click(function () {
        var pw = $("#pw").val();
        var pwCheck = $("#pw_check").val();

        if(pw === "" || pwCheck === "") {
            alert("비밀번호를 모두 입력해주세요.");
            return;
        }

        $.ajax({
            type: "post",
            url: "/pwcheck",
            data: { "pw": pw, "pwCheck": pwCheck },
            success: function (data) {
                if(data === "match") {
                    $("#pw_check_msg").text("비밀번호가 일치합니다.").css("color", "green");
                    isPwMatch = true;
                } else {
                    $("#pw_check_msg").text("비밀번호가 일치하지 않습니다.").css("color", "red");
                    isPwMatch = false;
                    $("#pw_check").focus();
                }
            },
            error: function () {
                alert("서버 통신 중 오류가 발생했습니다.");
            }
        });
    });

    $("form").submit(function () {
        if(!isPwMatch) {
            alert("비밀번호가 일치하지 않습니다.");
            return false;
        }
    });
});
</script>

<!-- NICKNAME check -->
<script>
    var isNickMatch = false;

    $(document).ready(function () {
        $("#nick_check_btn").click( function () {
            var nickname = $("#nickname").val();

            if(nickname === "") {
                alert("닉네임을 입력해주세요.");
                return;
            }

            $.ajax({
                type:"post",
                url:"/nickname_check",
                data:{"nickname":nickname},
                success: function(data) {
                    if(data === "match"){
                        $("#nick_check_msg").text("사용 가능한 닉네임입니다.").css("color", "green");
                        isNickMatch = true;
                    } else {
                        $("#nick_check_msg").text("이미 사용중인 닉네임입니다.").css("color", "red");
                        isNickMatch = false;
                        $("#nickname").focus().select();
                    }
                },
                error: function () {
                    alert("서버 통신 중 오류가 발생했습니다.");
                }
            });
        });

        $("form").submit(function() {
            if(!isNickMatch){
                alert("닉네임 중복 확인을 완료해주세요.");
                $("#nickname").focus().select();
                return false;
            }
        });
    });
</script>
<div>
    <h2>회원가입</h2>
    <form th:action="@{/signup_save}" th:object="${memberDTO}" method="post">

        <!-- ID ajax 유효성 검사 -->
        <div>
            <label>ID: </label>
            <input type="text" id="id" name="id"/>
            <button type="button" name="id_check" id="id_check">ID CHECK</button>
        </div>

        <!-- Validation 유효성 검사 -->
        <!--
        <div>
            <label>ID: </label>
            <input type="text" th:field="*{id}" />
            <p th:if="${#fields.hasErrors('id')}" th:errors="*{id}"></p>
        </div>
        -->

        <!-- 비밀번호 -->
        <div>
            <label>PW: </label>
            <input type="password" id="pw" name="pw"/>
        </div>

        <!-- 비밀번호 확인 -->
        <div>
            <label>PW CHECK: </label>
            <input type="password" id="pw_check" name="pwcheck"/>
            <button type="button" id="pw_check_btn">비밀번호 확인</button>
            <span id="pw_check_msg" style="color:red;"></span>
        </div>

        <!-- 닉네임 중복검사 -->
        <div>
            <label>NICKNAME: </label>
            <input type="text" id="nickname" name="nickname"/>
            <button type="button" id="nick_check_btn">닉네임 확인</button>
            <span id="nick_check_msg" style="color:red;"></span>
        </div>
        <div>
            <label>CELLPHONE: </label>
            <input type="text" id="phone" name="phone"/>
        </div>
        <div>
            <label>ADRESS: </label>
            <input type="text" id="madress" name="madress"/>
        </div>
        <button type="submit">SUBMIT</button>
    </form>
</div>
</body>
</html>